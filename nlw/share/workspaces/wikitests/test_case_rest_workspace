Test case to test `/data/workspaces`

* Fixture: SocialRest

This test case assumes a logged in user.

Test set up:

| st-admin | give-accounts-admin --username %%username%% | now has |
| set | wksp | w%%start_time%% |
| set | account_id | 2 |

| comment | GET non-existing workspace |  |
| get | /data/workspaces/%%wksp%% |  |
| code-is | 404 |  |

| comment | HEAD non-existant workspace |  |
| get | /data/workspaces/%%wksp%% |  |
| code-is | 404 |  |

| comment | POST a workspace |  |
| post | /data/workspaces | Content-Type=application/json | { "name":"%%wksp%%", "title":"W%%start_time%%", "account_id":"%%account_id%%" } |
| code-is | 201 |  |
| header-like | Location | /data/workspaces/%%wksp%% |

| comment | POST an existing workspace |  |
| post | /data/workspaces | Content-Type=application/json | { "name":"%%wksp%%", "title":"W%%start_time%%", "account_id":"%%account_id%%" } |
| code-is | 409 |  |

| comment | GET existing workspace as HTML by unauthorized user |  |
| get | /data/workspaces/%%wksp%% | text/html |
| code-is | 403 | User not authorized |

| comment | GET existing workspace as json by unathorized user |  |
| get | /data/workspaces/%%wksp%% | application/json |
| code-is | 403 | User not authorized |

| comment | GET existing workspace as json by non-member |  |
| st-admin | set-permissions --workspace %%wksp%% --permissions public | have been changed to public |
| get | /data/workspaces/%%wksp%% | application/json |
| code-is | 200 |  |
| body-like | me":"w%%start_time%%","title":"W%%start_time%%" |

| comment | Add a user to a workspace |  |
| post | /data/workspaces/%%wksp%%/users | Content-Type=application/json | { "username":"%%username%%", "rolename":"member", "send_confirmation_invitation":0 } |
| code-is | 201 |  |

| comment | GET existing workspace as HTML |  |
| get | /data/workspaces/%%wksp%% | text/html |
| code-is | 200 |  |
| body-like | workspace W%%start_time%% |  |

| comment | GET existing workspace as json by user |  |
| get | /data/workspaces/%%wksp%% | application/json |
| code-is | 200 |  |
| body-like | me":"w%%start_time%%","title":"W%%start_time%%" |

| comment | Promote a user to workspace admin |  |
| post | /data/workspaces/%%wksp%%/users | Content-Type=application/json | { "username":"%%username%%", "rolename":"workspace_admin" } |
| code-is | 201 |  |

| comment | GET existing workspace as json by admin |  |
| get | /data/workspaces/%%wksp%% | application/json |
| code-is | 200 |  |
| body-like | "workspace_id": |  |

| comment | GET short workspace name as HTML |  |
| get | /data/workspaces/aa | text/html |
| code-is | 400 |

| comment | GET short workspace name as JSON |  |
| get | /data/workspaces/aa | application/json |
| code-is | 400 |

----

These tests are from "Story: Add Backlink to IBM Lotus Connections via REST"<https://www2.socialtext.net/dev-tasks/index.cgi?story_add_backlink_to_ibm_lotus_connections_via_rest>.

| comment | Create a workspace with a customjs_uri |  |
| set | wksp | c%%start_time%% |
| post | /data/workspaces | Content-Type=application/json | { "name":"%%wksp%%", "title":"W%%start_time%%", "account_id":"%%account_id%%", "customjs_uri":"/monkey.js" } |
| code-is | 201 |  |
| header-like | Location | /data/workspaces/%%wksp%% |
| get | /data/workspaces/%%wksp%% | application/json |
| code-is | 403 |  |

Business admin can't read the workspace's json, so we will add the user as a workspace admin, who can verify it is set.

| post | /data/workspaces/%%wksp%%/users | Content-Type=application/json | { "username":"%%username%%", "rolename":"workspace_admin", "send_confirmation_invitation":0 } |
| get | /data/workspaces/%%wksp%% | application/json |
| code-is | 200 |  |
| body-like | "customjs_uri":"/monkey.js" |
| get | /%%wksp%%/index.cgi |  |
| body-like | /monkey.js |  |

| comment | Update the customjs_uri of a workspace |  |
| put | /data/workspaces/%%wksp%% | Content-Type=application/json | { "customjs_uri":"/buddha.js" } |
| code-is | 204 |  |
| get | /data/workspaces/%%wksp%% | application/json |
| code-is | 200 |  |
| body-like | "customjs_uri":"/buddha.js" |
| get | /%%wksp%%/index.cgi |  |
| body-like | /buddha.js |  |

| comment | Unset the customjs_uri of a workspace |  |
| put | /data/workspaces/%%wksp%% | Content-Type=application/json | { "customjs_uri":"" } |
| code-is | 204 |  |
| get | /data/workspaces/%%wksp%% | application/json |
| code-is | 200 |  |
| body-like | "customjs_uri":"" |
| get | /%%wksp%%/index.cgi |  |
| body-unlike | /monkey.js |  |

| comment | Update the customjs_uri as a workspace admin |  |
| st-admin | remove-accounts-admin --username %%username%% | no longer has |
| put | /data/workspaces/%%wksp%% | Content-Type=application/json | { "customjs_uri":"/kamma.js" } |
| code-is | 204 |  |
| get | /data/workspaces/%%wksp%% | application/json |
| code-is | 200 |  |
| body-like | "customjs_uri":"/kamma.js" |

| comment | Update the customjs_uri as a member |  |
| st-admin | remove-workspace-admin --username %%username%% --workspace=%%wksp%% | is no longer |
| put | /data/workspaces/%%wksp%% | Content-Type=application/json | { "customjs_uri":"/eraser.js" } |
| code-is | 401 |  |
| get | /data/workspaces/%%wksp%% | application/json |
| code-is | 200 |  |
| body-like | "name":" |  |
| body-unlike | "customjs_uri":" |  |

| comment | Update the customjs_uri as a nobody |  |
| st-admin | remove-member --username %%username%% --workspace=%%wksp%% | is no longer |
| put | /data/workspaces/%%wksp%% | Content-Type=application/json | { "customjs_uri":"/pencil.js" } |
| code-is | 401 |  |

| comment | Fetch the customjs_uri as a nobody |  |
| get | /data/workspaces/%%wksp%% | application/json |
| code-is | 403 |  |

| comment | Promote a user to workspace admin FAILS without permissions |  |
| post | /data/workspaces/%%wksp%%/users | Content-Type=application/json | { "username":"%%username%%", "rolename":"workspace_admin" } |
| code-is | 401 |  |
